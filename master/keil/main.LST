C51 COMPILER V9.52.0.0   MAIN                                                              03/20/2019 20:48:48 PAGE 1   


C51 COMPILER V9.52.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE main.c BROWSE DEBUG OBJECTEXTEND TABS(2)

line level    source

   1          #include <reg51.h>      //头文件
   2          
   3          
   4          //倒计时
   5          unsigned char buf[4];             //片选数码管变量
   6          unsigned int EW_time_default = 10;      //东西默认值
   7          unsigned int SN_time_default = 10;      //南北默认值
   8          unsigned int EW_time_now = 10;    //东西方向当前数秒
   9          unsigned int SN_time_now = 10;    //南北方向当前数秒
  10          
  11          //通行
  12          unsigned int SN_or_EW=0; //0：南北通行 1：东西通行
  13          unsigned int Open=1;
  14          
  15          //字型码
  16          unsigned char code LED[] = {0xc0, 0xf9, 0xa4, 0xb0, 0x99, 0x92, 0x82, 0xf8, 0x80, 0x90};
  17          
  18          
  19          //计数
  20          unsigned int time0_count;
  21          
  22          //红绿灯
  23          sbit Green_EW = P2 ^ 1;   //东西
  24          sbit Yellow_EW = P2 ^ 2;
  25          sbit Red_EW = P2 ^ 3;
  26          
  27          sbit Red_SN = P2 ^ 6;   //南北
  28          sbit Yellow_SN = P2 ^ 5;
  29          sbit Green_SN = P2 ^ 4;
  30          
  31          //函数声明
  32          void delay(int ms);     //延时
  33          void display();       //显示倒计时
  34          void init();          //开机初始化
  35          void Timer0Init();       //定时器0
  36          void traffic_light(); //控制信号灯
  37          void LED_light();      //控制倒计时
  38          
  39          void main()
  40          {
  41   1          init();
  42   1          while (1) {
  43   2              display();
  44   2          }
  45   1      }
  46          
  47          void init()
  48          {
  49   1          //开总中断
  50   1          EA = 1;
  51   1          ET0 = 1;      //开定时器0
  52   1          //定时器0
  53   1          Timer0Init();
  54   1      
  55   1      }
C51 COMPILER V9.52.0.0   MAIN                                                              03/20/2019 20:48:48 PAGE 2   

  56          
  57          void time0() interrupt 1
  58          {
  59   1          //重置定时器
  60   1          TH0 = 0x4c;
  61   1          TL0 = 0x00;
  62   1          //调整信号灯
  63   1          traffic_light();
  64   1          //调整倒计时
  65   1          LED_light();
  66   1      }
  67          
  68          void display() //显示子程序
  69          {
  70   1      
  71   1            
  72   1        
  73   1          //南北方向个位十位
  74   1          buf[0] = SN_time_now / 10;
  75   1          buf[1] = SN_time_now % 10;
  76   1          //东西方向个位十位
  77   1          buf[2] = EW_time_now / 10;
  78   1          buf[3] = EW_time_now % 10;
  79   1      
  80   1          //点亮南北方向倒计时
  81   1          P1 = 0x01;              //片选LED1
  82   1          P0 = LED[buf[0]];     //送南北时间十位的数码管编码
  83   1          delay(1);       //延时      
  84   1        
  85   1          P1 = 0x02;              //片选LED2
  86   1          P0 = LED[buf[1]];
  87   1          delay(1);
  88   1          
  89   1          P1 = 0X04;          //片选LED3
  90   1          P0 = LED[buf[2]];       //送东西时间十位的数码管编码
  91   1          delay(1);       //延时
  92   1          
  93   1          P1 = 0X08;        //片选LED4
  94   1          P0 = LED[buf[3]];
  95   1          delay(1); 
  96   1      }
  97          
  98          void traffic_light() //信号灯
  99          {
 100   1        P2=0x00;           //
 101   1        if((SN_or_EW))
 102   1        {
 103   2          //东西方向通行  绿灯亮
 104   2          Green_EW=Open;
 105   2          Red_EW=!Open;
 106   2          Yellow_EW=!Open;
 107   2          //南北方向进禁行 红灯亮
 108   2          Green_SN=!Open;
 109   2          Red_SN=Open;
 110   2          Yellow_SN=!Open;
 111   2        }else{
 112   2          //
 113   2          //东西方向禁行  红灯亮
 114   2          Green_EW=!Open;
 115   2          Red_EW=Open;
 116   2          Yellow_EW=!Open;
 117   2          //南北方向通行新痰屏
C51 COMPILER V9.52.0.0   MAIN                                                              03/20/2019 20:48:48 PAGE 3   

 118   2          Green_SN=Open;
 119   2          Red_SN=!Open;
 120   2          Yellow_SN=!Open;
 121   2      }
 122   1      }
 123          
 124          void LED_light() //倒计时
 125          {
 126   1          time0_count++;
 127   1          if(time0_count < 20) {}    //每秒检测一次，归零后重置，并切换通信方向
 128   1          else {
 129   2              time0_count = 0;
 130   2              if(SN_time_now > 0) {
 131   3                  SN_time_now--;
 132   3                  EW_time_now--;
 133   3              } else {
 134   3                  SN_time_now = SN_time_default;
 135   3                  EW_time_now = EW_time_default;
 136   3                  SN_or_EW=!SN_or_EW;
 137   3              }
 138   2          }
 139   1      }
 140          
 141          void delay(int ms)      //延时子程序
 142          {
 143   1          unsigned int j, k;
 144   1          for (j = 0; j < ms; j++)
 145   1              for (k = 0; k < 124; k++)
 146   1                  ;
 147   1      }
 148          
 149          void Timer0Init()   //50毫秒@11.0592MHz
 150          {
 151   1          TMOD = 0x01;  //设置定时器模式
 152   1          TL0 = 0x00;   //设置定时初值
 153   1          TH0 = 0x4C;   //设置定时初值
 154   1          TF0 = 0;      //清除TF0标志
 155   1          TR0 = 1;      //定时器0开始计时
 156   1      }
 157          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    383    ----
   CONSTANT SIZE    =     10    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     18    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
