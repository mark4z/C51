C51 COMPILER V9.52.0.0   MAIN                                                              03/21/2019 00:35:21 PAGE 1   


C51 COMPILER V9.52.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE main.c BROWSE DEBUG OBJECTEXTEND TABS(2)

line level    source

   1          #include <reg51.h>      //Í·ÎÄ¼þ
   2          
   3          
   4          //µ¹¼ÆÊ±
   5          unsigned char buf[4];             //Æ¬Ñ¡ÊýÂë¹Ü±äÁ¿
   6          unsigned int EW_time_default = 15;      //¶«Î÷Ä¬ÈÏÖµ
   7          unsigned int SN_time_default = 10;      //ÄÏ±±Ä¬ÈÏÖµ
   8          unsigned int EW_time_now = 15;    //¶«Î÷·½Ïòµ±Ç°ÊýÃë
   9          unsigned int SN_time_now = 10;    //ÄÏ±±·½Ïòµ±Ç°ÊýÃë
  10          
  11          //Í¨ÐÐ
  12          unsigned int SN_or_EW=0; //0£ºÄÏ±±Í¨ÐÐ 1£º¶«Î÷Í¨ÐÐ
  13          unsigned int Open=1;
  14          unsigned int SN_flash=0; //ÄÏ±±»ÆµÆÉÁË¸±êÖ¾
  15          unsigned int EW_flash=0; //¶«Î÷»ÆµÆÉÁË¸±êÖ¾
  16          
  17          //×ÖÐÍÂë
  18          unsigned char code LED[] = {0xc0, 0xf9, 0xa4, 0xb0, 0x99, 0x92, 0x82, 0xf8, 0x80, 0x90};
  19          
  20          
  21          //¼ÆÊý
  22          unsigned int time0_count; //1s¶¨Ê±
  23          unsigned int flash_count; //0.5s¶¨Ê±
  24          unsigned int flash_signl; //ÉÁË¸¼ÆÊýÐÅºÅ
  25          
  26          //ºìÂÌµÆ
  27          sbit Green_EW = P2 ^ 1;   //¶«Î÷
  28          sbit Yellow_EW = P2 ^ 2;
  29          sbit Red_EW = P2 ^ 3;
  30          
  31          sbit Red_SN = P2 ^ 6;   //ÄÏ±±
  32          sbit Yellow_SN = P2 ^ 5;
  33          sbit Green_SN = P2 ^ 4;
  34          
  35          //º¯ÊýÉùÃ÷
  36          void delay(int ms);     //ÑÓÊ±
  37          void display();       //ÏÔÊ¾µ¹¼ÆÊ±
  38          void init();          //¿ª»ú³õÊ¼»¯
  39          void Timer0Init();       //¶¨Ê±Æ÷0
  40          void traffic_light(); //¿ØÖÆÐÅºÅµÆ
  41          void LED_light();      //¿ØÖÆµ¹¼ÆÊ±
  42          void flash();         //»ÆµÆÉÁË¸
  43          
  44          void main()
  45          {
  46   1          init();
  47   1          while (1) {
  48   2            display();
  49   2          }
  50   1      }
  51          
  52          void init()
  53          {
  54   1          //¿ª×ÜÖÐ¶Ï
  55   1          EA = 1;
C51 COMPILER V9.52.0.0   MAIN                                                              03/21/2019 00:35:21 PAGE 2   

  56   1          ET0 = 1;      //¿ª¶¨Ê±Æ÷0
  57   1          //¶¨Ê±Æ÷0
  58   1          Timer0Init();
  59   1      }
  60          
  61          void time0() interrupt 1
  62          {
  63   1          //ÖØÖÃ¶¨Ê±Æ÷
  64   1          TH0 = 0x4c;
  65   1          TL0 = 0x00;
  66   1          //µ÷ÕûÐÅºÅµÆ
  67   1          traffic_light();
  68   1          //µ÷Õûµ¹¼ÆÊ±
  69   1          LED_light();
  70   1          //µ÷Õû»ÆµÆ
  71   1          flash();
  72   1      }
  73          
  74          void display() //ÏÔÊ¾×Ó³ÌÐò
  75          {
  76   1      
  77   1            
  78   1        
  79   1          //ÄÏ±±·½Ïò¸öÎ»Ê®Î»
  80   1          buf[0] = SN_time_now / 10;
  81   1          buf[1] = SN_time_now % 10;
  82   1          //¶«Î÷·½Ïò¸öÎ»Ê®Î»
  83   1          buf[2] = EW_time_now / 10;
  84   1          buf[3] = EW_time_now % 10;
  85   1      
  86   1          //µãÁÁÄÏ±±·½Ïòµ¹¼ÆÊ±
  87   1          P1 = 0x01;              //Æ¬Ñ¡LED1
  88   1          P0 = LED[buf[0]];     //ËÍÄÏ±±Ê±¼äÊ®Î»µÄÊýÂë¹Ü±àÂë
  89   1          delay(1);       //ÑÓÊ±      
  90   1        
  91   1          P1 = 0x02;              //Æ¬Ñ¡LED2
  92   1          P0 = LED[buf[1]];
  93   1          delay(1);
  94   1          
  95   1          P1 = 0X04;          //Æ¬Ñ¡LED3
  96   1          P0 = LED[buf[2]];       //ËÍ¶«Î÷Ê±¼äÊ®Î»µÄÊýÂë¹Ü±àÂë
  97   1          delay(1);       //ÑÓÊ±
  98   1          
  99   1          P1 = 0X08;        //Æ¬Ñ¡LED4
 100   1          P0 = LED[buf[3]];
 101   1          delay(1); 
 102   1      }
 103          
 104          void traffic_light() //ÐÅºÅµÆ
 105          {         //
 106   1        if((SN_or_EW))
 107   1        {
 108   2          //¶«Î÷·½ÏòÍ¨ÐÐ  ÂÌµÆÁÁ
 109   2          if(EW_time_now>5){Green_EW=Open;EW_flash=!Open;} //Ð¡ÓÚ5sÊ±£¬»ÆµÆÉÁË¸
 110   2          else{Green_EW=!Open;EW_flash=Open;}
 111   2          Red_EW=!Open;
 112   2          //ÄÏ±±·½Ïò½ø½ûÐÐ ºìµÆÁÁ
 113   2          SN_flash=!Open;  //¹Ø±Õ»ÆµÆ
 114   2          Green_SN=!Open;
 115   2          Red_SN=Open;
 116   2        }
 117   1        else{
C51 COMPILER V9.52.0.0   MAIN                                                              03/21/2019 00:35:21 PAGE 3   

 118   2          //¶«Î÷·½Ïò½ûÐÐ  ºìµÆÁÁ
 119   2          EW_flash=!Open; //¹Ø±Õ»ÆµÆ
 120   2          Green_EW=!Open;
 121   2          Red_EW=Open;
 122   2          //ÄÏ±±·½ÏòÍ¨ÐÐûÐÂÌµÆÁÁ
 123   2          if(SN_time_now>5){Green_SN=Open;SN_flash=!Open;} //Ð¡ÓÚ5sÊ±£¬»ÆµÆÉÁË¸
 124   2          else{Green_SN=!Open; SN_flash=Open;}
 125   2          Red_SN=!Open;
 126   2      }
 127   1      }
 128          
 129          void flash()
 130          {
 131   1        flash_count++;
 132   1        if(flash_count>=10)  //0.5sÉÁË¸Ò»´Î
 133   1          {
 134   2            flash_count=0;
 135   2            flash_signl++;
 136   2            if(flash_signl>10)
 137   2              flash_signl=0; //ÉÁË¸ÐÅºÅÇåÁã
 138   2            
 139   2            //»ÆµÆÉÁË¸
 140   2            if(SN_flash) {Yellow_SN=flash_signl%2;}
 141   2            else {Yellow_SN=!Open;}
 142   2            if(EW_flash) {Yellow_EW=flash_signl%2;}
 143   2            else {Yellow_EW=!Open;}
 144   2          }
 145   1      }
 146          
 147          void LED_light() //µ¹¼ÆÊ±
 148          {
 149   1          time0_count++;
 150   1          if(time0_count >= 20) 
 151   1          {
 152   2            //Ã¿Ãë¼ì²âÒ»´Î£¬¹éÁãºóÖØÖÃ£¬²¢ÇÐ»»Í¨ÐÐ·½Ïò
 153   2              time0_count = 0;
 154   2            //¶«Î÷Í¨ÐÐÊ
 155   2              if(EW_time_now > 0) {
 156   3                  SN_time_now--;
 157   3                  EW_time_now--;
 158   3                 if(SN_time_now<=0)
 159   3                   {
 160   4                     if(SN_or_EW){
 161   5                        SN_time_now=EW_time_now;}
 162   4                     }else{EW_time_now=SN_time_now;}
 163   3              } else {
 164   3                  SN_time_now = SN_time_default;
 165   3                  EW_time_now = EW_time_default;
 166   3                  SN_or_EW=!SN_or_EW;
 167   3              }
 168   2            }
 169   1      }
 170          
 171          void delay(int ms)      //ÑÓÊ±×Ó³ÌÐò
 172          {
 173   1          unsigned int j, k;
 174   1          for (j = 0; j < ms; j++)
 175   1              for (k = 0; k < 124; k++)
 176   1                  ;
 177   1      }
 178          
 179          void Timer0Init()   //50ºÁÃë@11.0592MHz
C51 COMPILER V9.52.0.0   MAIN                                                              03/21/2019 00:35:21 PAGE 4   

 180          {
 181   1          TMOD = 0x01;  //ÉèÖÃ¶¨Ê±Æ÷Ä£Ê½
 182   1          TL0 = 0x00;   //ÉèÖÃ¶¨Ê±³õÖµ
 183   1          TH0 = 0x4C;   //ÉèÖÃ¶¨Ê±³õÖµ
 184   1          TF0 = 0;      //Çå³ýTF0±êÖ¾
 185   1          TR0 = 1;      //¶¨Ê±Æ÷0¿ªÊ¼¼ÆÊ±
 186   1      }
 187          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    634    ----
   CONSTANT SIZE    =     10    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     26    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
